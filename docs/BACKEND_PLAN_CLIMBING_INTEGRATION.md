# Бэкенд: интеграция лазания в план тренировок

Типичный сценарий: **лазание 1–2 часа → затем ОФП/СФП**. План поддерживает опцию «День = лазание + ОФП» и отображает статус лазания вместе с упражнениями.

---

## 1. POST /api/climbing-logs/plans — новое поле

| Поле | Тип | Описание |
|------|-----|----------|
| `include_climbing_in_days` | bool | День = лазание + ОФП/СФП. По умолчанию `true`. Рекомендуется сохранять при создании плана. |

**Пример тела:**
```json
{
  "template_key": "amateur",
  "duration_weeks": 4,
  "start_date": "2026-02-17",
  "days_per_week": 3,
  "scheduled_weekdays": [1, 3, 5],
  "include_climbing_in_days": true,
  "has_fingerboard": true,
  "preferred_style": "both",
  "experience_months": 12
}
```

**Рекомендации:**
- Сохранять `include_climbing_in_days` в активном плане пользователя.
- Возвращать его в ответе на POST (в объекте `plan`) и в GET /plans/active.

---

## 2. GET /api/climbing-logs/plans/active — расширение ответа

Добавить в объект плана:

```json
{
  "id": 12,
  "template_key": "novice_zero",
  "start_date": "2026-02-14",
  "end_date": "2026-02-27",
  "scheduled_weekdays": [1, 3, 5],
  "scheduled_weekdays_labels": ["Пн", "Ср", "Пт"],
  "include_climbing_in_days": true
}
```

- `include_climbing_in_days` — bool, по умолчанию `true` (если бэкенд не хранит — фронт использует default).

---

## 3. GET /api/climbing-logs/plans/{id}/day — опциональное поле дня

В ответе для дня с упражнениями можно добавить:

| Поле | Тип | Описание |
|------|-----|----------|
| `expects_climbing` | bool | Ожидается лазание в этот день. Если `true`, фронт показывает блок «1. Лазание» перед упражнениями. |

**Логика:**
- Если бэкенд возвращает `expects_climbing: true` — фронт показывает блок лазания.
- Если не возвращает — фронт использует `plan.include_climbing_in_days` (из GET /plans/active).
- Для `session_type: rest` блок лазания не показывается.

---

## 4. Связь с climbing logs

Фронт определяет, есть ли лазание за дату, через:
- **GET /api/climbing-logs/history** — список сессий; фильтрация по `date` на клиенте.

**Рекомендация для бэкенда:** поддержать фильтр по дате:
```
GET /api/climbing-logs/history?date=2026-02-14
```
или
```
GET /api/climbing-logs/sessions?date=2026-02-14
```
Ответ: сессия за дату или пустой массив. Так фронт не загружает весь список истории для проверки одной даты.

---

## 5. Отметка выполнения сессии (POST /plans/{id}/complete)

Текущий формат не меняется. Отметка «сессия выполнена» относится к ОФП/СФП, а не к лазанию.

**Опционально для аналитики:** бэкенд может проверять наличие climbing session за эту дату (при `include_climbing_in_days: true`) и использовать это для:
- рекомендаций по нагрузке;
- статистики «полных» тренировочных дней (лазание + ОФП).

---

## 6. Краткий чеклист

| Эндпоинт | Изменение |
|----------|-----------|
| POST /plans | Принимать и сохранять `include_climbing_in_days` |
| GET /plans/active | Возвращать `include_climbing_in_days` |
| GET /plans/{id}/day | Опционально: `expects_climbing` в ответе |
| GET /climbing-logs/history | Рекомендуется: параметр `?date=YYYY-MM-DD` для проверки сессии за дату |

---

## 7. Поток пользователя на фронте

1. **Создание плана:** пользователь выбирает «День = лазание + ОФП» (вкл/выкл).
2. **План на день:** показывается блок «1. Лазание» (добавить / ✓ выполнено), затем «2. Упражнения».
3. **Карточка «Сегодня»:** при `include_climbing_in_days` отображается «Лазание ✓» или «Лазание +».
4. **ClimbingLogAddScreen:** при открытии из плана дата предзаполнена (`initialDate`).
