# API: Статистика соревнования

Спецификация для бэкенда — эндпоинт агрегированной статистики соревнования для раздела «Статистика» в деталях соревнования.

---

## Цель

Мобильное приложение отображает в разделе «Статистика» (вкладка в деталях соревнования) общую сводку по соревнованию. Нужен один эндпоинт, возвращающий все агрегированные данные в одном запросе.

---

## Эндпоинт

**Метод:** `GET`  
**URL:** `/api/event/{event_id}/statistics`  
**Альтернатива:** `/api/competitions/{event_id}/statistics` или `/api/event/statistics?event_id={event_id}`

**Headers:**
```
Accept: application/json
Authorization: Bearer {token}   # опционально — зависит от схемы доступа
```

**Параметры:** `event_id` — ID соревнования (event/competition).

---

## Структура ответа (200 OK)

```json
{
  "participants_total": 87,
  "participants_male": 52,
  "participants_female": 35,
  "routes_total": 15,
  "flashes_total": 124,
  "redpoints_total": 89,
  "zones_total": 45
}
```

### Описание полей

| Поле | Тип | Описание |
|------|-----|----------|
| `participants_total` | `int` | Общее количество участников (зарегистрированных на соревнование) |
| `participants_male` | `int` | Количество участников мужского пола |
| `participants_female` | `int` | Количество участников женского пола |
| `routes_total` | `int` | Общее количество трасс (в квалификации + при наличии полуфинал + финал) |
| `flashes_total` | `int` | Суммарное количество флешей по всем участникам и трассам (attempt = 1) |
| `redpoints_total` | `int` | Суммарное количество редпоинтов по всем участникам и трассам (attempt = 2) |
| `zones_total` | `int` | Суммарное количество зон по всем участникам и трассам (attempt = 3) |

### Примечания

- **Пол участника:** значение `gender` из таблицы участников. Ожидаемые значения: `male`, `female`, `Мужской`, `Женский` и т.п. — надо привести к двум группам (male/female).
- **Попытки (attempt):** те же коды, что и при отправке результатов (`/api/event/{id}/send/results`): `0` — X, `1` — Flash, `2` — Redpoint, `3` — Zone.
- **Трассы:** считать все трассы, привязанные к событию (квалификация, полуфинал, финал — по фактической структуре события).
- Если данные ещё не заполнены (нет результатов, нет участников и т.д.), возвращать `0` для соответствующих полей.

---

## Ошибки

| HTTP | Случай |
|------|--------|
| `404` | Событие не найдено |
| `403` | Нет доступа к статистике (если решите ограничить) |
| `500` | Внутренняя ошибка сервера |

Тело ошибки (по возможности):
```json
{
  "message": "Событие не найдено"
}
```

---

## Использование на клиенте

Мобильное приложение (Flutter) будет использовать этот эндпоинт в разделе «Статистика» для отображения:

- карточек с числами (участники, трассы, флеши, редпоинты);
- круговой диаграммы «Мужчины / Женщины»;
- столбчатой диаграммы «Флеши vs Редпоинты vs Зоны».

Один запрос при открытии вкладки — без дополнительных вызовов к `/api/participants` или `/api/routes` для этой сводки.
