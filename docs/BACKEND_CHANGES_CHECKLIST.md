# Чеклист изменений на бэкенде (план тренировок)

Сводка правок по результатам багфиксов и доработок фронта.

---

## 1. GET /api/climbing-logs/plans/{id}/calendar — календарь

### 1.1 Поле `completed`
**Проблема:** Все прошедшие даты отображались как выполненные (зелёные).

**Что менять:** `completed: true` ставить **только** для дат, по которым был вызван `POST /plans/{id}/complete`.  
**Нельзя** делать: `completed = (date <= today)`.

### 1.2 Даты до старта плана
**Проблема:** Даты до `start_date` показывали иконки ОФП/СФП/отдых (рука, гиря, лист).

**Что менять:** В `days` возвращать записи только для дат **между start_date и end_date** плана. Либо возвращать весь месяц — тогда фронт сам отфильтрует (уже реализовано), но лучше не отдавать лишнее.

---

## 2. GET /api/climbing-logs/plans/{id}/day — план на день

### 2.1 Согласованность с календарём
**Проблема:** По дням с иконкой (ОФП/СФП) в календаре при нажатии показывалось «Нет данных».

**Что менять:** Для любой даты, которая есть в `days` календаря с `session_type: ofp` или `sfp`, `GET /day?date=...` **должен** возвращать данные (упражнения, stretching и т.д.). Для `rest` — можно возвращать `session_type: rest` без exercises.

### 2.2 Поля упражнения (если ещё не реализованы)
- `exercise_id` — для связи с exercise-completions
- `dosage` — готовый текст («3 подхода по 12 повторений»)
- `hint` — текст подсказки «Как выполнять»

---

## 3. POST /api/climbing-logs/plans и GET /plans/active — лазание в плане

### 3.1 Новое поле `include_climbing_in_days`
- **POST /plans:** принимать и сохранять `include_climbing_in_days` (bool, default true)
- **GET /plans/active:** возвращать `include_climbing_in_days` в объекте плана

### 3.2 GET /day — опционально `expects_climbing`
Для дней ОФП/СФП можно возвращать `expects_climbing: true`, если лазание ожидается. Фронт использует и без этого (берёт из плана).

---

## 4. GET /api/climbing-logs/history — фильтр по дате

**Рекомендация:** Поддержать `?date=YYYY-MM-DD` для проверки сессии лазания за конкретную дату (для блока «Лазание» в плане).

---

## Краткая таблица

| Эндпоинт | Поле/логика | Действие |
|----------|-------------|----------|
| GET /plans/{id}/calendar | `completed` | Только true для дат с POST /complete |
| GET /plans/{id}/calendar | `days` | Только даты в [start_date, end_date] |
| GET /plans/{id}/day | — | Возвращать данные для всех ofp/sfp дней из календаря |
| POST /plans | `include_climbing_in_days` | Принимать, сохранять |
| GET /plans/active | `include_climbing_in_days` | Возвращать |
| GET /climbing-logs/history | `?date=` | Опционально: фильтр по дате |
