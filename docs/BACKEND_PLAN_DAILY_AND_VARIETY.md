# Backend: ежедневный план и разнообразие упражнений

Рекомендации для бэкенда по плану тренировок и ротации упражнений.

---

## 1. Ежедневный план

**Требование:** каждый новый день пользователь получает план на этот день.

**Текущая логика Flutter:**
- Кэш плана привязан к дате: `exercise_completion_screen_cache_YYYY-MM-DD`
- При открытии экрана в новый день кэш пуст → загрузка свежего плана
- План генерируется на основе **последних сохранённых замеров** (StrengthDashboardService.getLastMetrics)

**Рекомендация для бэкенда (если план будет на бэке):**
- Эндпоинт `GET /api/climbing-logs/training-plan?date=YYYY-MM-DD` — план на указанную дату
- Ответ зависит от даты: один план на день, при смене даты — другой
- Метрики берутся из последнего сохранённого замера пользователя

---

## 2. Новый замер → предложение пересобрать план

**Реализовано во Flutter:**
- После сохранения замера показывается диалог: «Сгенерировать план с учётом новых данных?»
- [Сгенерировать] — очищается кэш на сегодня, открывается экран упражнений с новыми метриками
- [Позже] — план остаётся прежним (по старым замерам), можно зайти позже

**Бэкенд:** не требует изменений, логика на клиенте.

---

## 3. Разные упражнения по дням (ротация)

**Требование:** не показывать одни и те же упражнения каждый день.

**Flutter передаёт параметр `day_offset`:**
- `GET /api/climbing-logs/exercises?level=...&category=ofp&day_offset=0..6`
- `day_offset` = `DateTime.now().weekday % 7` (0–6, день недели)
- Используется для ОФП и растяжки

**Рекомендация для бэкенда:**
- Поддерживать query-параметр `day_offset` (0–6)
- При выборе упражнений учитывать `day_offset` для ротации:
  - разбить каталог на группы (A, B, C…)
  - day_offset 0 → группа A, 1 → B, 2 → C и т.д.
  - или сдвиг по приоритетному списку: `start_index = (day_offset * N) % total`
- Цель: разные наборы упражнений в разные дни при том же уровне

---

## 4. СФП (план) — локальная генерация

СФП-упражнения (Max Hangs, Power Pulls, Repeaters и т.д.) генерируются в Flutter в `TrainingPlanGenerator` по слабому звену из замеров. Бэкенд в этом не участвует.

**Опционально для бэкенда:**
- Эндпоинт `GET /api/climbing-logs/training-plan` с телом запроса (метрики) — возвращать СФП-план с ротацией по дате
- Параметр `date` или `day_offset` для выбора вариантов упражнений

---

## 5. Чеклист для бэкенда

- [ ] Добавить `day_offset` (0–6) в `GET /exercises` для ротации ОФП и растяжки
- [ ] Реализовать логику ротации: разные упражнения при разных `day_offset`
- [ ] (Опционально) Эндпоинт дневного плана `GET /training-plan?date=...`
